generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                          Int                   @id @default(autoincrement())
  role                        UserRole
  name                        String
  email                       String                @unique
  passwordHash                String
  emailVerifiedAt             DateTime?
  emailVerificationTokenHash  String?               @unique
  emailVerificationExpiresAt  DateTime?
  passwordResetTokenHash      String?               @unique
  passwordResetExpiresAt      DateTime?
  phone                       String?
  location                    String?
  createdAt                   DateTime              @default(now())
  isSuspended                 Boolean               @default(false)
  suspendedAt                 DateTime?
  suspendedReason             String?
  riskScore                    Int                   @default(0)
  restrictedUntil              DateTime?
  adminActions                AdminAction[]         @relation("AdminActions")
  bids                        Bid[]                 @relation("UserBids")
  blocksReceived              Block[]               @relation("UserBlocksBlocked")
  blocksGiven                 Block[]               @relation("UserBlocksBlocker")
  favoriteJobs                FavoriteJob[]         @relation("FavoriteJobUser")
  favoriteProvidersAsConsumer FavoriteProvider[]    @relation("FavoriteProviderConsumer")
  favoriteProvidersAsProvider FavoriteProvider[]    @relation("FavoriteProviderProvider")
  jobs                        Job[]                 @relation("UserJobs")
  awardedJobs                 Job[]                 @relation("JobAwardedProvider")
  completionConfirmationsPending Job[]              @relation("JobCompletionPendingForUser")
  hiddenJobs                  Job[]                 @relation("HiddenJobsByAdmin")
  messageReadStates           JobMessageReadState[]
  hiddenMessages              Message[]             @relation("HiddenMessagesByAdmin")
  messagesSent                Message[]
  notifications               Notification[]
  pushTokens                  PushToken[]
  jobMatchNotifications       JobMatchNotification[]
  providerProfile             ProviderProfile?
  bidTemplates                BidTemplate[]
  quickReplies                ProviderQuickReply[]
  providerAvailabilities      ProviderAvailability[]
  appointmentsAsProvider      Appointment[]         @relation("AppointmentsProvider")
  appointmentsAsConsumer      Appointment[]         @relation("AppointmentsConsumer")
  providerVerification        ProviderVerification?
  providerVerificationUploads ProviderVerificationAttachment[] @relation("ProviderVerificationUploader")
  reportsHandled              Report[]              @relation("ReportHandledByAdmin")
  reportsGiven                Report[]              @relation("ReportReporter")
  reportsAgainst              Report[]              @relation("ReportTargetUser")
  reviewsGiven                Review[]              @relation("ReviewsGiven")
  reviewsReceived             Review[]              @relation("ReviewsReceived")
  disputesOpened              Dispute[]
  subscription                Subscription?
  subscriptionPayments        SubscriptionPayment[]
  stripePayments              StripePayment[]
  providerEntitlement         ProviderEntitlement?
  addonPurchases              AddonPurchase[]
  providerStats               ProviderStats?
  adRevenue                   AdRevenue[]
  payouts                     Payout[]
  securityEvents              SecurityEvent[]
  savedSearches               ProviderSavedSearch[]

  // AI usage guardrails (monthly quota)
  aiMonthlyTokenLimit          Int?
  aiTokensUsedThisMonth        Int                   @default(0)
  aiUsageMonthKey              String?
}

model AiCacheEntry {
  key             String   @id
  taskType        String
  normalizedInput String
  response        Json
  model           String
  createdAt       DateTime @default(now())
  expiresAt       DateTime?

  @@index([taskType])
  @@index([createdAt])
  @@index([expiresAt])
}

model ProviderSavedSearch {
  id          Int      @id @default(autoincrement())
  providerId  Int
  categories  String[] @default([])
  radiusMiles Int
  zipCode     String
  minBudget   Int?
  maxBudget   Int?
  isEnabled   Boolean  @default(true)
  createdAt   DateTime @default(now())

  provider    User     @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([providerId, isEnabled])
  @@index([createdAt])
}

model BidTemplate {
  id            Int      @id @default(autoincrement())
  providerId    Int
  title         String
  body          String
  defaultAmount Int?
  tags          String[] @default([])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  provider      User     @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([createdAt])
}

model ProviderQuickReply {
  id         Int      @id @default(autoincrement())
  providerId Int
  title      String
  body       String
  tags       String[] @default([])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  provider   User     @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([createdAt])
}

model SecurityEvent {
  id          String    @id @default(cuid())
  actionType  String    @map("type")
  actorUserId Int?      @map("userId")
  actorRole   UserRole?
  actorEmail  String?   @map("email")
  targetType  String?
  targetId    String?
  ip          String?
  userAgent   String?
  metadataJson Json?    @map("details")
  createdAt   DateTime  @default(now())

  actor       User?     @relation(fields: [actorUserId], references: [id])

  @@index([actionType])
  @@index([actorUserId])
  @@index([createdAt])
}

model Job {
  id          Int                   @id @default(autoincrement())
  consumerId  Int
  awardedProviderId Int?
  completionPendingForUserId Int?
  title       String
  description String
  budgetMin   Int?
  budgetMax   Int?
  status      JobStatus             @default(OPEN)
  location    String?
  category    String?
  trade       String?
  urgency     String?
  suggestedTags String[]            @default([])
  suggestedMinPrice Int?
  suggestedMaxPrice Int?
  suggestedReason   String?
  riskScore    Int                   @default(0)
  awardedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime              @default(now())
  hiddenAt    DateTime?
  hiddenById  Int?
  isHidden    Boolean               @default(false)
  bids        Bid[]
  favorites   FavoriteJob[]         @relation("FavoriteJobJob")
  consumer    User                  @relation("UserJobs", fields: [consumerId], references: [id])
  awardedProvider User?             @relation("JobAwardedProvider", fields: [awardedProviderId], references: [id])
  completionPendingForUser User?    @relation("JobCompletionPendingForUser", fields: [completionPendingForUserId], references: [id])
  hiddenBy    User?                 @relation("HiddenJobsByAdmin", fields: [hiddenById], references: [id])
  attachments JobAttachment[]
  readStates  JobMessageReadState[]
  photos      JobPhoto[]
  messages    Message[]
  appointments Appointment[]
  reports     Report[]              @relation("ReportTargetJob")
  reviews     Review[]
  disputes    Dispute[]
  matchNotifications JobMatchNotification[]

  @@index([awardedProviderId])
  @@index([completionPendingForUserId])
  @@index([completedAt])
}

enum AppointmentStatus {
  PROPOSED
  CONFIRMED
  CANCELLED
}

model ProviderAvailability {
  id         Int      @id @default(autoincrement())
  providerId Int
  dayOfWeek  Int      // 0=Sun ... 6=Sat
  startTime  String   // "HH:MM"
  endTime    String   // "HH:MM"
  timezone   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  provider   User     @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([providerId, dayOfWeek])
}

model Appointment {
  id         Int               @id @default(autoincrement())
  jobId      Int
  providerId Int
  consumerId Int
  startAt    DateTime
  endAt      DateTime
  status     AppointmentStatus @default(PROPOSED)
  calendarEventId String?
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt

  job        Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  provider   User              @relation("AppointmentsProvider", fields: [providerId], references: [id], onDelete: Cascade)
  consumer   User              @relation("AppointmentsConsumer", fields: [consumerId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([providerId, startAt])
  @@index([consumerId, startAt])
}

model JobPhoto {
  id    Int    @id @default(autoincrement())
  jobId Int
  url   String
  job   Job    @relation(fields: [jobId], references: [id])
}

model Bid {
  id         Int       @id @default(autoincrement())
  jobId      Int
  providerId Int
  amount     Int
  message    String
  status     BidStatus @default(PENDING)
  createdAt  DateTime  @default(now())

  job        Job       @relation(fields: [jobId], references: [id])
  provider   User      @relation("UserBids", fields: [providerId], references: [id])

  counter    CounterOffer?

  @@unique([jobId, providerId]) // âœ… ADD THIS
}


model Message {
  id         Int       @id @default(autoincrement())
  senderId   Int
  text       String
  createdAt  DateTime  @default(now())
  jobId      Int
  hiddenAt   DateTime?
  hiddenById Int?
  isHidden   Boolean   @default(false)
  hiddenBy   User?     @relation("HiddenMessagesByAdmin", fields: [hiddenById], references: [id])
  job        Job       @relation(fields: [jobId], references: [id])
  sender     User      @relation(fields: [senderId], references: [id])
  reports    Report[]  @relation("ReportTargetMessage")
  attachments MessageAttachment[]
}

model ProviderProfile {
  id          Int        @id @default(autoincrement())
  providerId  Int        @unique
  experience  String?
  specialties String?
  rating      Float?
  reviewCount Int?
  verificationBadge Boolean   @default(false)
  featuredZipCodes   String[]  @default([])
  provider    User       @relation(fields: [providerId], references: [id])
  categories  Category[] @relation("CategoryToProviderProfile")
}

enum ProviderVerificationStatus {
  NONE
  PENDING
  VERIFIED
  REJECTED
}

enum ProviderVerificationMethod {
  ID
  BACKGROUND_CHECK
}

model ProviderVerification {
  providerId           Int                        @id
  status               ProviderVerificationStatus  @default(NONE)
  method               ProviderVerificationMethod?
  providerSubmittedAt  DateTime?
  verifiedAt           DateTime?
  metadataJson         Json?
  createdAt            DateTime                   @default(now())
  updatedAt            DateTime                   @updatedAt

  provider             User                       @relation(fields: [providerId], references: [id], onDelete: Cascade)
  attachments          ProviderVerificationAttachment[]

  @@index([status])
  @@index([providerSubmittedAt])
  @@index([verifiedAt])
}

model ProviderVerificationAttachment {
  id              Int      @id @default(autoincrement())
  providerId       Int
  uploaderUserId   Int
  filename         String?
  mimeType         String?
  sizeBytes        Int?
  diskPath         String?
  createdAt        DateTime @default(now())

  verification     ProviderVerification @relation(fields: [providerId], references: [providerId], onDelete: Cascade)
  uploader         User                 @relation("ProviderVerificationUploader", fields: [uploaderUserId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([uploaderUserId])
  @@index([createdAt])
}

model Subscription {
  id        Int                   @id @default(autoincrement())
  userId    Int                   @unique
  tier      SubscriptionTier      @default(FREE)
  renewsAt  DateTime?
  usageMonthKey            String   @default("")
  leadsUsedThisMonth       Int      @default(0)
  extraLeadCreditsThisMonth Int     @default(0)
  createdAt DateTime              @default(now())
  user      User                  @relation(fields: [userId], references: [id])
  payments  SubscriptionPayment[]
  stripePayments StripePayment[]
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  type      String
  content   Json
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model PushToken {
  id         Int      @id @default(autoincrement())
  userId     Int
  token      String   @unique
  platform   String?
  lastSeenAt DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum BackgroundJobStatus {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
}

model BackgroundJob {
  id          Int                @id @default(autoincrement())
  type        String
  payload     Json
  status      BackgroundJobStatus @default(PENDING)
  runAt       DateTime           @default(now())
  attempts    Int                @default(0)
  maxAttempts Int                @default(8)
  lockedAt    DateTime?
  lockedBy    String?
  lastError   String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  @@index([status, runAt])
  @@index([lockedAt])
  @@index([createdAt])
}

model JobMatchNotification {
  id         Int      @id @default(autoincrement())
  jobId      Int
  providerId Int
  score      Float?
  createdAt  DateTime @default(now())

  job        Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  provider   User     @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@unique([jobId, providerId])
  @@index([providerId, createdAt])
  @@index([jobId, createdAt])
}

model Review {
  id             Int      @id @default(autoincrement())
  jobId          Int
  reviewerUserId Int
  revieweeUserId Int
  rating         Int
  text           String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now()) @updatedAt

  job            Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  reviewer       User     @relation("ReviewsGiven", fields: [reviewerUserId], references: [id], onDelete: Cascade)
  reviewee       User     @relation("ReviewsReceived", fields: [revieweeUserId], references: [id], onDelete: Cascade)

  @@unique([jobId, reviewerUserId])
  @@index([jobId])
  @@index([revieweeUserId])
}

enum DisputeStatus {
  OPEN
  INVESTIGATING
  RESOLVED
}

model Dispute {
  id              Int           @id @default(autoincrement())
  jobId           Int
  openedByUserId  Int
  reasonCode      String
  description     String?
  status          DisputeStatus @default(OPEN)
  createdAt       DateTime      @default(now())
  resolvedAt      DateTime?
  resolutionNotes String?

  job             Job           @relation(fields: [jobId], references: [id], onDelete: Cascade)
  openedBy        User          @relation(fields: [openedByUserId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([openedByUserId])
  @@index([status])
  @@index([createdAt])
}

model FavoriteProvider {
  id         Int      @id @default(autoincrement())
  consumerId Int
  providerId Int
  createdAt  DateTime @default(now())
  consumer   User     @relation("FavoriteProviderConsumer", fields: [consumerId], references: [id])
  provider   User     @relation("FavoriteProviderProvider", fields: [providerId], references: [id])

  @@unique([consumerId, providerId])
}

model FavoriteJob {
  id        Int      @id @default(autoincrement())
  userId    Int
  jobId     Int
  createdAt DateTime @default(now())
  job       Job      @relation("FavoriteJobJob", fields: [jobId], references: [id])
  user      User     @relation("FavoriteJobUser", fields: [userId], references: [id])

  @@unique([userId, jobId])
}

model SubscriptionPayment {
  id             Int              @id @default(autoincrement())
  userId         Int
  subscriptionId Int?
  tier           SubscriptionTier
  amount         Int
  status         PaymentStatus    @default(SUCCEEDED)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  subscription   Subscription?    @relation(fields: [subscriptionId], references: [id])
  user           User             @relation(fields: [userId], references: [id])
}

model StripePayment {
  id                   String           @id @default(cuid())
  userId               Int
  subscriptionId       Int?
  tier                 SubscriptionTier
  amount               Int
  currency             String           @default("usd")
  stripePaymentIntentId String          @unique
  kind                 StripePaymentKind @default(SUBSCRIPTION)
  addonType            ProviderAddonType?
  addonQuantity        Int?
  addonZipCodes        String[]          @default([])
  status               PaymentStatus    @default(PENDING)
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  subscription         Subscription?    @relation(fields: [subscriptionId], references: [id])
  user                 User             @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model ProviderEntitlement {
  id               String   @id @default(cuid())
  providerId        Int     @unique
  verificationBadge Boolean @default(false)
  featuredZipCodes  String[] @default([])
  leadCredits       Int     @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  provider          User    @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId])
}

model ProviderStats {
  id                            String   @id @default(cuid())
  providerId                    Int      @unique

  avgRating                     Float?
  ratingCount                   Int      @default(0)

  jobsCompletedAllTime          Int      @default(0)
  jobsCompleted30d              Int      @default(0)

  medianResponseTimeSeconds30d  Int?

  cancellationRate30d           Float    @default(0)
  disputeRate30d                Float    @default(0)
  reportRate30d                 Float    @default(0)

  updatedAt                     DateTime @updatedAt

  provider                      User     @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([updatedAt])
}

model AddonPurchase {
  id                   String     @id @default(cuid())
  providerId            Int
  addonType             AddonType
  amountCents           Int
  currency              String     @default("usd")
  stripePaymentIntentId String     @unique
  status                PaymentStatus @default(PENDING)
  metadataJson          Json?
  createdAt             DateTime   @default(now())

  provider              User       @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([status])
  @@index([createdAt])
}

model AdRevenue {
  id         String   @id @default(cuid())
  userId     Int
  adFormat   String   // "banner" or "interstitial"
  platform   String   @default("admob")
  impressions Int     @default(0)
  clicks     Int      @default(0)
  revenue    Decimal  @db.Decimal(10, 4)
  currency   String   @default("usd")
  date       DateTime @default(now())
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([date])
}

model Payout {
  id           String   @id @default(cuid())
  userId       Int
  type         String   // "subscription" or "ad_revenue"
  amount       Decimal  @db.Decimal(10, 2)
  currency     String   @default("usd")
  status       String   @default("pending") // "pending", "processing", "completed", "failed"
  stripePayoutId String?
  description  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  paidAt       DateTime?
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
}

model JobAttachment {
  id        Int      @id @default(autoincrement())
  jobId     Int
  url       String
  diskPath  String?
  uploaderUserId Int?
  type      String?
  mimeType  String?
  filename  String?
  sizeBytes Int?
  createdAt DateTime @default(now())
  job       Job      @relation(fields: [jobId], references: [id])

  @@index([jobId])
}

model MessageAttachment {
  id        Int      @id @default(autoincrement())
  messageId Int
  url       String
  diskPath  String?
  uploaderUserId Int?
  mimeType  String?
  filename  String?
  sizeBytes Int?
  createdAt DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}

model Category {
  id               Int               @id @default(autoincrement())
  name             String
  slug             String            @unique
  createdAt        DateTime          @default(now())
  providerProfiles ProviderProfile[] @relation("CategoryToProviderProfile")
}

model Block {
  id        Int      @id @default(autoincrement())
  blockerId Int
  blockedId Int
  createdAt DateTime @default(now())
  blocked   User     @relation("UserBlocksBlocked", fields: [blockedId], references: [id])
  blocker   User     @relation("UserBlocksBlocker", fields: [blockerId], references: [id])

  @@unique([blockerId, blockedId])
}

model Report {
  id               Int              @id @default(autoincrement())
  reporterId       Int
  targetUserId     Int?
  targetJobId      Int?
  targetMessageId  Int?
  targetType       ReportTargetType
  reason           String
  details          String?
  createdAt        DateTime         @default(now())
  status           ReportStatus     @default(OPEN)
  adminNotes       String?
  handledAt        DateTime?
  handledByAdminId Int?
  adminActions     AdminAction[]    @relation("AdminActionReport")
  handledByAdmin   User?            @relation("ReportHandledByAdmin", fields: [handledByAdminId], references: [id])
  reporter         User             @relation("ReportReporter", fields: [reporterId], references: [id])
  targetJob        Job?             @relation("ReportTargetJob", fields: [targetJobId], references: [id])
  targetMessage    Message?         @relation("ReportTargetMessage", fields: [targetMessageId], references: [id])
  targetUser       User?            @relation("ReportTargetUser", fields: [targetUserId], references: [id])

  @@index([targetType, targetUserId])
  @@index([targetType, targetJobId])
  @@index([targetType, targetMessageId])
}

model AdminAction {
  id        Int             @id @default(autoincrement())
  adminId   Int
  type      AdminActionType
  reportId  Int?
  entityId  Int?
  notes     String?
  createdAt DateTime        @default(now())
  admin     User            @relation("AdminActions", fields: [adminId], references: [id])
  report    Report?         @relation("AdminActionReport", fields: [reportId], references: [id])

  @@index([adminId, createdAt])
  @@index([type, createdAt])
  @@index([reportId])
}

model JobMessageReadState {
  id         Int      @id @default(autoincrement())
  jobId      Int
  userId     Int
  lastReadAt DateTime @default(now())
  updatedAt  DateTime @updatedAt
  job        Job      @relation(fields: [jobId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([jobId, userId])
  @@index([userId, lastReadAt])
  @@index([jobId, lastReadAt])
}

model WebhookEndpoint {
  id         Int               @id @default(autoincrement())
  url        String
  secret     String
  enabled    Boolean           @default(true)
  events     String[]
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  deliveries WebhookDelivery[]

  @@index([enabled, createdAt])
}

model WebhookDelivery {
  id             Int                      @id @default(autoincrement())
  endpointId     Int
  event          String
  payload        Json
  status         WebhookDeliveryStatus    @default(PENDING)
  attempts       Int                      @default(0)
  lastError      String?
  nextAttempt    DateTime?
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  deliveredAt    DateTime?
  lastAttemptAt  DateTime?
  lastStatusCode Int?
  endpoint       WebhookEndpoint          @relation(fields: [endpointId], references: [id], onDelete: Cascade)
  attemptLogs    WebhookDeliveryAttempt[]

  @@index([status, nextAttempt])
  @@index([endpointId, createdAt])
}

model WebhookDeliveryAttempt {
  id              Int             @id @default(autoincrement())
  deliveryId      Int
  attemptNumber   Int
  startedAt       DateTime        @default(now())
  finishedAt      DateTime?
  durationMs      Int?
  ok              Boolean?
  statusCode      Int?
  error           String?
  responseSnippet String?
  retryAfter      String?
  createdAt       DateTime        @default(now())
  endpointId      Int?
  endpointUrl     String?
  event           String?
  delivery        WebhookDelivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)

  @@index([deliveryId, attemptNumber])
  @@index([deliveryId, createdAt])
  @@index([startedAt])
}

enum UserRole {
  CONSUMER
  PROVIDER
  ADMIN
}

enum JobStatus {
  OPEN
  IN_PROGRESS
  COMPLETED_PENDING_CONFIRMATION
  COMPLETED
  CANCELLED
}

enum BidStatus {
  PENDING
  ACCEPTED
  DECLINED
}

enum SubscriptionTier {
  FREE
  BASIC
  PRO
}

enum PaymentStatus {
  PENDING
  SUCCEEDED
  FAILED
}

enum StripePaymentKind {
  SUBSCRIPTION
  ADDON
}

enum ProviderAddonType {
  EXTRA_LEADS
  VERIFICATION_BADGE
  FEATURED_ZIP_CODES
}

enum AddonType {
  VERIFICATION_BADGE
  FEATURED_ZIP
  LEAD_PACK
}

enum ReportTargetType {
  USER
  JOB
  MESSAGE
}

enum ReportStatus {
  OPEN
  IN_REVIEW
  RESOLVED
  DISMISSED
}

enum AdminActionType {
  REPORT_STATUS_CHANGED
  USER_SUSPENDED
  USER_UNSUSPENDED
  JOB_HIDDEN
  JOB_UNHIDDEN
  MESSAGE_HIDDEN
  MESSAGE_UNHIDDEN
  ADMIN_IMPERSONATION_STARTED
  ADMIN_IMPERSONATION_STOPPED
}

enum WebhookDeliveryStatus {
  PENDING
  SUCCESS
  FAILED
  PROCESSING
}

enum CounterStatus {
  PENDING
  ACCEPTED
  DECLINED
}

model CounterOffer {
  id        Int          @id @default(autoincrement())
  bidId     Int          @unique
  bid       Bid          @relation(fields: [bidId], references: [id], onDelete: Cascade)

  // Range support
  minAmount Int?
  maxAmount Int?

  // Canonical single amount (use max or exact)
  amount    Int
  message   String

  status    CounterStatus @default(PENDING)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}
